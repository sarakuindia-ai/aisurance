<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Micro Insurance Recommendation - Medical Records Analysis</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            font-weight: 300;
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-content {
            padding: 40px;
        }

        .user-selection {
            margin-bottom: 40px;
        }

        .user-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .user-card {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .user-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            border-color: #4facfe;
        }

        .user-card.selected {
            border-color: #4facfe;
            background: linear-gradient(135deg, #4facfe20, #00f2fe20);
        }

        .user-basic-info {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #e9ecef;
        }

        .user-card h3 {
            color: #333;
            margin-bottom: 8px;
            font-size: 1.3rem;
        }

        .contact-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 15px;
        }

        .contact-info p {
            color: #666;
            font-size: 0.9rem;
        }

        .medical-section {
            margin-top: 15px;
        }

        .medical-section h4 {
            color: #4facfe;
            font-size: 1rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .medical-list {
            background: white;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
        }

        .medical-list ul {
            list-style: none;
            padding: 0;
        }

        .medical-list li {
            color: #666;
            font-size: 0.85rem;
            margin-bottom: 4px;
            padding-left: 15px;
            position: relative;
        }

        .medical-list li:before {
            content: "•";
            color: #4facfe;
            position: absolute;
            left: 0;
        }

        .process-btn {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 50px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 30px 0;
            display: block;
            margin-left: auto;
            margin-right: auto;
        }

        .process-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.3);
        }

        .process-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .results-section {
            margin-top: 40px;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }

        .results-section.show {
            opacity: 1;
            transform: translateY(0);
        }

        .medical-analysis {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
        }

        .analysis-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .analysis-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border-left: 4px solid #4facfe;
        }

        .analysis-card h4 {
            color: #333;
            margin-bottom: 10px;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .analysis-card p {
            color: #666;
            line-height: 1.5;
            font-size: 0.95rem;
        }

        .risk-level {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            margin-top: 10px;
        }

        .risk-low { background: #d4edda; color: #155724; }
        .risk-medium { background: #fff3cd; color: #856404; }
        .risk-high { background: #f8d7da; color: #721c24; }

        .products-section {
            margin-top: 30px;
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 25px;
            margin-top: 25px;
        }

        .product-card {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 15px;
            padding: 25px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .product-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(135deg, #4facfe, #00f2fe);
        }

        .product-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .product-card h4 {
            color: #333;
            font-size: 1.2rem;
            margin-bottom: 5px;
        }

        .product-price {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.9rem;
            font-weight: bold;
        }

        .product-card p {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.6;
            font-size: 0.95rem;
        }

        .match-score {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: bold;
            margin-bottom: 15px;
            display: inline-block;
        }

        .coverage-list {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
        }

        .coverage-list ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .coverage-list li {
            color: #555;
            font-size: 0.85rem;
            margin-bottom: 4px;
            padding-left: 15px;
            position: relative;
        }

        .coverage-list li:before {
            content: "✓";
            color: #28a745;
            font-weight: bold;
            position: absolute;
            left: 0;
        }

        .cta-buttons {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            font-size: 0.9rem;
        }

        .btn-secondary {
            background: transparent;
            color: #667eea;
            border: 2px solid #667eea;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            transition: all 0.3s ease;
            flex: 1;
            font-size: 0.9rem;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-secondary:hover {
            background: #667eea;
            color: white;
        }

        .email-section {
            background: #f8f9fa;
            border-radius: 15px;
            padding: 25px;
            margin-top: 30px;
            text-align: center;
        }

        .loading {
            text-align: center;
            padding: 40px;
        }

        .spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #4facfe;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .section-title {
            color: #333;
            font-size: 1.5rem;
            margin-bottom: 15px;
            font-weight: 300;
        }

        .success-message {
            background: linear-gradient(135deg, #4facfe20, #00f2fe20);
            border: 2px solid #4facfe;
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            text-align: center;
            color: #333;
        }

        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .main-content {
                padding: 20px;
            }
            
            .user-grid {
                grid-template-columns: 1fr;
            }
            
            .contact-info {
                grid-template-columns: 1fr;
            }
            
            .cta-buttons {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Micro Insurance Recommendations</h1>
            <p>AI-Powered Medical Record Analysis for Personalized Insurance Solutions</p>
        </div>

        <div class="main-content">
            <div class="user-selection">
                <h2 class="section-title">Select a Patient Profile</h2>
                <div class="user-grid" id="userGrid">
                    <!-- Users will be populated here -->
                </div>
                <button class="process-btn" id="processBtn" onclick="processUser()" disabled>
                    Analyze Medical Records & Recommend Insurance
                </button>
            </div>

            <div id="loadingSection" class="loading" style="display: none;">
                <div class="spinner"></div>
                <p>Analyzing medical records, health data, and insurance claims...</p>
            </div>

            <div class="results-section" id="resultsSection">
                <!-- Results will be populated here -->
            </div>
        </div>
    </div>

    <script>
        // Hardcoded patient data with medical records
        const patients = [
            {
                id: 1,
                name: "Sarah Johnson",
                email: "sarah.j@email.com",
                phone: "+1-555-0123",
                age: 32,
                medicalHistory: [
                    "Type 2 Diabetes (diagnosed 2020)",
                    "Hypertension (controlled)",
                    "Family history of heart disease"
                ],
                healthRecords: [
                    "Regular blood sugar monitoring",
                    "Monthly doctor visits",
                    "Blood pressure medication",
                    "Annual eye examinations"
                ],
                claimHistory: [
                    "Diabetes medication claims: $2,400/year",
                    "Doctor visit claims: $1,800/year",
                    "Emergency room visit (2023): $3,500"
                ]
            },
            {
                id: 2,
                name: "Michael Chen",
                email: "m.chen@email.com",
                phone: "+1-555-0124",
                age: 28,
                medicalHistory: [
                    "Asthma (childhood onset)",
                    "Seasonal allergies",
                    "Minor sports injuries"
                ],
                healthRecords: [
                    "Inhaler prescriptions",
                    "Allergy testing completed",
                    "Physical therapy (2023)",
                    "Annual wellness checkups"
                ],
                claimHistory: [
                    "Asthma medication: $800/year",
                    "Physical therapy: $1,200 (2023)",
                    "Allergy treatment: $400/year"
                ]
            },
            {
                id: 3,
                name: "Emily Rodriguez",
                email: "emily.r@email.com",
                phone: "+1-555-0125",
                age: 45,
                medicalHistory: [
                    "Breast cancer survivor (2019)",
                    "Regular mammograms",
                    "Anxiety disorder"
                ],
                healthRecords: [
                    "Oncology follow-ups every 6 months",
                    "Mental health counseling",
                    "Preventive screenings",
                    "Hormone therapy"
                ],
                claimHistory: [
                    "Cancer treatment: $45,000 (2019-2020)",
                    "Follow-up care: $8,000/year",
                    "Mental health services: $2,400/year"
                ]
            },
            {
                id: 4,
                name: "David Thompson",
                email: "david.t@email.com",
                phone: "+1-555-0126",
                age: 38,
                medicalHistory: [
                    "Lower back injury (work-related)",
                    "High cholesterol",
                    "Sleep apnea"
                ],
                healthRecords: [
                    "Chiropractic treatment",
                    "CPAP machine usage",
                    "Cholesterol monitoring",
                    "Physical therapy sessions"
                ],
                claimHistory: [
                    "Back injury treatment: $5,500 (2022)",
                    "CPAP equipment: $2,000",
                    "Chiropractic care: $3,600/year"
                ]
            },
            {
                id: 5,
                name: "Lisa Wang",
                email: "lisa.w@email.com",
                phone: "+1-555-0127",
                age: 35,
                medicalHistory: [
                    "Pregnancy complications (2021)",
                    "Gestational diabetes",
                    "Postpartum depression"
                ],
                healthRecords: [
                    "Postpartum care",
                    "Blood sugar monitoring",
                    "Mental health support",
                    "Regular gynecological exams"
                ],
                claimHistory: [
                    "Pregnancy/delivery: $12,000 (2021)",
                    "Postpartum care: $3,500",
                    "Mental health treatment: $1,800/year"
                ]
            }
        ];

        // Medical analysis data for each patient
        const medicalAnalysis = {
            1: {
                riskAssessment: "Moderate to High risk due to diabetes and hypertension. Requires specialized diabetes management and cardiovascular monitoring.",
                healthTrends: "Stable condition with regular monitoring. Good medication compliance but needs enhanced preventive care.",
                recommendedCare: "Focus on diabetic complications prevention, regular cardiac screenings, and emergency coverage for diabetes-related incidents.",
                riskLevel: "high"
            },
            2: {
                riskAssessment: "Low to Moderate risk. Young, active individual with manageable chronic conditions.",
                healthTrends: "Excellent health management. Minimal claims history suggests good overall health with proper condition management.",
                recommendedCare: "Preventive care focus, sports injury protection, and respiratory condition management.",
                riskLevel: "low"
            },
            3: {
                riskAssessment: "High risk due to cancer history. Requires comprehensive coverage with focus on cancer recurrence monitoring.",
                healthTrends: "Cancer-free for 4+ years with excellent follow-up care. Mental health needs ongoing support.",
                recommendedCare: "Cancer surveillance, mental health support, and comprehensive preventive screenings.",
                riskLevel: "high"
            },
            4: {
                riskAssessment: "Moderate risk with occupational health concerns and multiple chronic conditions requiring ongoing management.",
                healthTrends: "Multiple conditions under control with regular treatment. Work-related injury history suggests occupational risks.",
                recommendedCare: "Occupational health protection, chronic disease management, and disability coverage.",
                riskLevel: "medium"
            },
            5: {
                riskAssessment: "Moderate risk with focus on reproductive health and mental health support needs.",
                healthTrends: "Post-pregnancy health stable. History of gestational diabetes increases future diabetes risk.",
                recommendedCare: "Women's health focus, diabetes prevention, mental health support, and family planning coverage.",
                riskLevel: "medium"
            }
        };

        // Micro insurance products
        const microInsuranceProducts = [
            {
                id: 1,
                name: "Diabetes Care Plus",
                description: "Comprehensive micro-insurance for diabetes management including medication, testing supplies, and emergency care.",
                price: "$25/month",
                coverage: ["Diabetes medications", "Blood glucose testing strips", "Emergency diabetes care", "Specialist consultations"],
                targetConditions: ["diabetes", "blood sugar", "hypertension"],
                maxClaim: "$15,000/year"
            },
            {
                id: 2,
                name: "Respiratory Health Shield",
                description: "Specialized coverage for asthma and respiratory conditions with medication and emergency care benefits.",
                price: "$15/month",
                coverage: ["Asthma medications", "Inhaler replacements", "Emergency respiratory care", "Pulmonologist visits"],
                targetConditions: ["asthma", "respiratory", "allergies"],
                maxClaim: "$8,000/year"
            },
            {
                id: 3,
                name: "Cancer Survivor Care",
                description: "Specialized insurance for cancer survivors focusing on follow-up care and recurrence monitoring.",
                price: "$45/month",
                coverage: ["Oncology visits", "Cancer screenings", "Imaging tests", "Mental health support"],
                targetConditions: ["cancer", "oncology", "survivor", "screening"],
                maxClaim: "$25,000/year"
            },
            {
                id: 4,
                name: "Back & Spine Protection",
                description: "Targeted coverage for back injuries and chronic spine conditions including therapy and treatment.",
                price: "$20/month",
                coverage: ["Chiropractic care", "Physical therapy", "Spine imaging", "Pain management"],
                targetConditions: ["back", "spine", "injury", "chiropractic"],
                maxClaim: "$10,000/year"
            },
            {
                id: 5,
                name: "Women's Health Complete",
                description: "Comprehensive women's health insurance including reproductive health and pregnancy-related care.",
                price: "$30/month",
                coverage: ["Gynecological exams", "Pregnancy care", "Postpartum support", "Women's screenings"],
                targetConditions: ["pregnancy", "women", "gynecological", "reproductive"],
                maxClaim: "$20,000/year"
            },
            {
                id: 6,
                name: "Mental Wellness Support",
                description: "Mental health focused micro-insurance covering therapy, counseling, and psychiatric care.",
                price: "$22/month",
                coverage: ["Therapy sessions", "Psychiatric consultations", "Mental health medications", "Crisis intervention"],
                targetConditions: ["mental", "anxiety", "depression", "therapy"],
                maxClaim: "$12,000/year"
            },
            {
                id: 7,
                name: "Heart Health Guardian",
                description: "Cardiovascular health insurance with focus on heart disease prevention and management.",
                price: "$28/month",
                coverage: ["Cardiology visits", "Heart screenings", "Cardiac medications", "Emergency heart care"],
                targetConditions: ["heart", "cardiovascular", "hypertension", "cardiac"],
                maxClaim: "$18,000/year"
            },
            {
                id: 8,
                name: "Emergency Care Essentials",
                description: "Basic emergency care coverage for unexpected medical situations and urgent care needs.",
                price: "$12/month",
                coverage: ["Emergency room visits", "Urgent care", "Ambulance services", "Emergency medications"],
                targetConditions: ["emergency", "urgent", "accident"],
                maxClaim: "$5,000/year"
            },
            {
                id: 9,
                name: "Chronic Condition Manager",
                description: "Multi-condition coverage for patients with multiple chronic health conditions requiring ongoing care.",
                price: "$35/month",
                coverage: ["Multiple specialist visits", "Chronic disease medications", "Regular monitoring", "Care coordination"],
                targetConditions: ["chronic", "multiple", "specialist", "monitoring"],
                maxClaim: "$22,000/year"
            },
            {
                id: 10,
                name: "Preventive Care Plus",
                description: "Focus on preventive healthcare with regular checkups, screenings, and wellness programs.",
                price: "$18/month",
                coverage: ["Annual wellness exams", "Preventive screenings", "Vaccinations", "Health education"],
                targetConditions: ["preventive", "wellness", "screening", "checkup"],
                maxClaim: "$8,000/year"
            }
        ];

        let selectedPatient = null;
        const notificationEmail = "medical-team@microinsurance.com";

        // Initialize the app
        function init() {
            renderPatients();
        }

        function renderPatients() {
            const userGrid = document.getElementById('userGrid');
            userGrid.innerHTML = patients.map(patient => `
                <div class="user-card" onclick="selectUser(${patient.id}, this)">
                    <div class="user-basic-info">
                        <h3>${patient.name}</h3>
                        <div class="contact-info">
                            <p><strong>Email:</strong> ${patient.email}</p>
                            <p><strong>Phone:</strong> ${patient.phone}</p>
                            <p><strong>Age:</strong> ${patient.age} years</p>
                            <p><strong>Patient ID:</strong> P${patient.id.toString().padStart(4, '0')}</p>
                        </div>
                    </div>
                    
                    <div class="medical-section">
                        <h4>🏥 Medical History</h4>
                        <div class="medical-list">
                            <ul>
                                ${patient.medicalHistory.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <h4>📋 Health Records</h4>
                        <div class="medical-list">
                            <ul>
                                ${patient.healthRecords.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <h4>💰 Claim History</h4>
                        <div class="medical-list">
                            <ul>
                                ${patient.claimHistory.map(item => `<li>${item}</li>`).join('')}
                            </ul>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function selectUser(userId, element) {
            selectedPatient = patients.find(u => u.id === userId);
            
            // Update UI
            document.querySelectorAll('.user-card').forEach(card => card.classList.remove('selected'));
            element.classList.add('selected');
            document.getElementById('processBtn').disabled = false;
        }

        function processUser() {
            if (!selectedPatient) return;

            // Show loading
            document.getElementById('loadingSection').style.display = 'block';
            document.getElementById('resultsSection').classList.remove('show');

            // Simulate processing delay
            setTimeout(() => {
                analyzeAndRecommend();
                document.getElementById('loadingSection').style.display = 'none';
                document.getElementById('resultsSection').classList.add('show');
            }, 4000);
        }

        function analyzeAndRecommend() {
            const analysis = medicalAnalysis[selectedPatient.id];
            const recommendations = calculateRecommendations(selectedPatient.id);

            const resultsSection = document.getElementById('resultsSection');
            resultsSection.innerHTML = `
                <h2 class="section-title">Medical Analysis for ${selectedPatient.name}</h2>
                <div class="medical-analysis">
                    <div class="analysis-grid">
                        <div class="analysis-card">
                            <h4>🔍 Risk Assessment</h4>
                            <p>${analysis.riskAssessment}</p>
                            <span class="risk-level risk-${analysis.riskLevel}">
                                ${analysis.riskLevel.toUpperCase()} RISK
                            </span>
                        </div>
                        <div class="analysis-card">
                            <h4>📈 Health Trends</h4>
                            <p>${analysis.healthTrends}</p>
                        </div>
                        <div class="analysis-card">
                            <h4>💡 Recommended Care</h4>
                            <p>${analysis.recommendedCare}</p>
                        </div>
                    </div>
                </div>

                <div class="products-section">
                    <h2 class="section-title">Recommended Micro Insurance Products</h2>
                    <div class="products-grid">
                        ${recommendations.map(product => `
                            <div class="product-card">
                                <div class="product-header">
                                    <h4>${product.name}</h4>
                                    <div class="product-price">${product.price}</div>
                                </div>
                                <div class="match-score">${product.matchScore}% Match</div>
                                <p>${product.description}</p>
                                <div class="coverage-list">
                                    <strong>Coverage includes:</strong>
                                    <ul>
                                        ${product.coverage.map(item => `<li>${item}</li>`).join('')}
                                    </ul>
                                    <p style="margin-top: 10px; font-size: 0.8rem; color: #666;">
                                        <strong>Max Claim:</strong> ${product.maxClaim}
                                    </p>
                                </div>
                                <div class="cta-buttons">
                                    <button class="btn-primary" onclick="buyNow('${product.name}', '${product.price}')">Buy Now</button>
                                    <button class="btn-secondary" onclick="requestCallback('${product.name}')">Call Back</button>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                </div>

                <div class="email-section">
                    <h3>📧 Medical Team Notification Sent</h3>
                    <p>A detailed medical analysis and insurance recommendation report has been sent to: <strong>${notificationEmail}</strong></p>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        Report includes patient medical history, risk assessment, and personalized micro-insurance recommendations.
                    </p>
                    <button class="btn-primary" onclick="sendEmailNotification()" style="margin-top: 15px;">
                        Resend Medical Report
                    </button>
                </div>
            `;
        }

        function calculateRecommendations(patientId) {
            const patient = patients.find(p => p.id === patientId);
            const medicalText = [...patient.medicalHistory, ...patient.healthRecords, ...patient.claimHistory]
                .join(' ').toLowerCase();

            return microInsuranceProducts.map(product => {
                let score = 20; // Base score
                
                product.targetConditions.forEach(condition => {
                    if (medicalText.includes(condition.toLowerCase())) {
                        score += 15;
                    }
                });
                
                // Add some smart matching based on medical conditions
                if (patientId === 1 && product.name.includes('Diabetes')) score += 25;
                if (patientId === 1 && product.name.includes('Heart')) score += 20;
                if (patientId === 2 && product.name.includes('Respiratory')) score += 25;
                if (patientId === 3 && product.name.includes('Cancer')) score += 25;
                if (patientId === 3 && product.name.includes('Mental')) score += 20;
                if (patientId === 4 && product.name.includes('Back')) score += 25;
                if (patientId === 4 && product.name.includes('Heart')) score += 15;
                if (patientId === 5 && product.name.includes('Women')) score += 25;
                if (patientId === 5 && product.name.includes('Mental')) score += 20;
                
                // Ensure emergency and preventive care are relevant for everyone
                if (product.name.includes('Emergency')) score += 10;
                if (product.name.includes('Preventive')) score += 8;
                
                // Add some randomization for demo purposes
                score += Math.floor(Math.random() * 10);
                score = Math.min(score, 95);

                return {
                    ...product,
                    matchScore: score
                };
            })
            .filter(product => product.matchScore > 35)
            .sort((a, b) => b.matchScore - a.matchScore)
            .slice(0, 4); // Show top 4 recommendations
        }

        function buyNow(productName, price) {
            alert(`🛒 Redirecting to purchase ${productName} at ${price} for ${selectedPatient.name}...\n\n✅ Patient Medical Records Verified\n📋 Risk Assessment Completed\n💳 Proceeding to Secure Checkout\n\nIn a real application, this would redirect to a secure payment gateway with pre-filled patient information.`);
        }

        function requestCallback(productName) {
            alert(`📞 Callback requested for ${productName}!\n\n👨‍⚕️ Our medical insurance specialist will contact:\n\n📝 Patient: ${selectedPatient.name}\n📱 Phone: ${selectedPatient.phone}\n📧 Email: ${selectedPatient.email}\n⏰ Expected callback: Within 2 hours\n\n🏥 They will discuss the medical coverage details and help with the enrollment process.`);
        }

        function sendEmailNotification() {
            const emailContent = generateEmailContent();
            
            // Simulate email sending
            document.querySelector('.email-section').innerHTML += `
                <div class="success-message">
                    <h4>✅ Medical Report Sent Successfully!</h4>
                    <p><strong>Sent to:</strong> ${notificationEmail}</p>
                    <p><strong>Patient:</strong> ${selectedPatient.name} (Age: ${selectedPatient.age})</p>
                    <p><strong>Report includes:</strong> Medical history analysis, risk assessment, personalized micro-insurance recommendations, and next steps for patient care.</p>
                    <p style="margin-top: 10px; font-size: 0.9rem; color: #666;">
                        📄 Report ID: MED-${Date.now()}<br>
                        📅 Generated: ${new Date().toLocaleDateString()}<br>
                        ⏰ Timestamp: ${new Date().toLocaleTimeString()}
                    </p>
                </div>
            `;
        }

        function generateEmailContent() {
            const analysis = medicalAnalysis[selectedPatient.id];
            return `
                Subject: Medical Insurance Analysis Report - ${selectedPatient.name}
                
                Dear Medical Insurance Team,
                
                We have completed a comprehensive medical record analysis and generated personalized micro-insurance recommendations for the following patient:
                
                PATIENT INFORMATION:
                ==================
                Name: ${selectedPatient.name}
                Age: ${selectedPatient.age} years
                Email: ${selectedPatient.email}
                Phone: ${selectedPatient.phone}
                Patient ID: P${selectedPatient.id.toString().padStart(4, '0')}
                
                MEDICAL HISTORY:
                ===============
                ${selectedPatient.medicalHistory.map(item => `• ${item}`).join('\n')}
                
                HEALTH RECORDS:
                ==============
                ${selectedPatient.healthRecords.map(item => `• ${item}`).join('\n')}
                
                CLAIM HISTORY:
                =============
                ${selectedPatient.claimHistory.map(item => `• ${item}`).join('\n')}
                
                RISK ASSESSMENT:
                ===============
                Risk Level: ${analysis.riskLevel.toUpperCase()}
                Assessment: ${analysis.riskAssessment}
                
                RECOMMENDED ACTION:
                ==================
                ${analysis.recommendedCare}
                
                Please review the detailed recommendations in the system dashboard and follow up with the patient regarding the suggested micro-insurance products.
                
                Best regards,
                AI Medical Insurance Analysis System
                
                Report Generated: ${new Date().toLocaleString()}
                System Version: v2.1.0
            `;
        }

        // Initialize the app when DOM is loaded
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
